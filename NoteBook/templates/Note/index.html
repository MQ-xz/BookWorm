{% extends 'Main/nav.html' %}
{% block title%} {{ note.title }} {% endblock %}
{% block index %}

{% include 'django_quill/media.html' %}

<div class="row">
    <div class="col-md-9">
        <h2>{{ note.title }}</h2>
        <p>{{ note.description }} {{ mode }}</p>
    </div>
    <div class="col-md-3">
        <i class="fas fa-share-alt"></i>
        <i class="fas fa-cog"></i><br>
        {% if mode == 'edit' %}
        <a href="?">
            <i class="fas fa-save"></i>
        </a>
        {% else %}
        <a href="?mode=edit">
            <i class="fas fa-edit"></i>
        </a>
        {% endif %}
        <span>Last edited : {{ note.updated_at }}</span>
    </div>
</div>

{% if mode == 'edit' %}
<form method="post" onkeydown="isKeyPressed(event)">
    {% csrf_token %}
    {{ form.content }}
    <button type="submit">Save</button>
</form>
{% else %}
{{ note.content.html | safe}}
{% endif %}


<script>
    // setInterval(function () {
    //     console.log('hehe')
    // }, 6000);
    // let text = document.getElementsByClassName('ql-editor')[0];
    // text.addEventListener('input', function (event) {
    //     console.log(text.innerText);
    // if (event.shiftKey && event.keyCode == 9) {
    //     console.log("The SHIFT key was pressed!");
    // } else {
    //     console.log("The SHIFT key was not pressed!");
    // }
    // fetch('/updateNote/{{ note.url }}', {
    //     method: 'POST',
    //     headers: {
    //         'X-CSRFToken': '{{ csrf_token }}'
    //     },
    //     body: JSON.stringify({
    //         content: text.innerText
    //     }),
    // })
    // });

    function test(data) {
        console.log(data)
        document.getElementsByClassName('ql-editor')[0].innerText += data['content'];
    }

    function isKeyPressed(event) {
        if (event.shiftKey) {
            let text = document.getElementsByClassName('ql-editor')[0];
            fetch('/updateNote/{{ note.url }}', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({
                    content: text.innerText
                })
            }).then(response => response.json())
                .then(data => test(data));
        }
    }
</script>
{% endblock %}