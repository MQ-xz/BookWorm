{% extends 'Main/nav.html' %}
{% block title%} {{ note.title }} {% endblock %}
{% block index %}

{% include 'django_quill/media.html' %}

<div class="row">
    <div class="col-md-9">
        <h2>{{ note.title }}</h2>
        <p>{{ note.description }} {{ mode }}</p>
    </div>
    <div class="col-md-3">
        <i class="fas fa-share-alt"></i>
        <i class="fas fa-cog"></i><br>
        {% if mode == 'edit' %}
        <a href="?">
            <i class="fas fa-save"></i>
        </a>
        {% else %}
        <a href="?mode=edit">
            <i class="fas fa-edit"></i>
        </a>
        {% endif %}
        <span>Last edited : {{ note.updated_at }}</span>
    </div>
</div>

{% if mode == 'edit' %}
<form method="post">
    {% csrf_token %}
    {{ form.content }}
    <button type="submit">Save</button>
</form>
{% else %}
{{ note.content.html | safe}}
{% endif %}


<script>
    // setInterval(function () {
    //     console.log('hehe')
    // }, 6000);
    let text = document.getElementsByClassName('ql-editor')[0];
    text.addEventListener('input', function () {
        console.log(text.innerText);
        fetch('/updateNote/{{ note.url }}', {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({
                content: text.innerText
            }),
        })
    });
</script>
{% endblock %}